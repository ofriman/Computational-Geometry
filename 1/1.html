<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Assignment 1</title>
  <meta name="description" content="Computational Geometry - Assignment 1">
  <meta name="author" content="OrenFriman">
  <style type="text/css">
    label {
      cursor: pointer;
    }
    textarea {
      width: 400px;
      height: 150px;
    }
  </style>
</head>
<body>
  <div>
   <label for="input-file">Specify a file:</label><br>
   <input type="file" id="input-file">
  </div>
  <textarea id="content-target" readonly></textarea>
  <div id="draw-target"></div>

  <script type="text/javascript">
    const contentArea = document.getElementById('content-target');
    const contentDraw = document.getElementById('draw-target');
    document.getElementById('input-file').addEventListener('change', event => {
          const file = event.target.files && event.target.files[0];
          if (file) {
            const reader = new FileReader();
            return new Promise((resolve, reject) => {
              reader.onload = event => resolve(event.target.result);
              reader.onerror = error => reject(error);
              reader.readAsText(file);
            }).then(content => {
              contentArea.value = content;

              const numbers = content.trim().split(/\s+/);
              const n = + numbers[0];
              const p = numbers.slice(1, 2 * n + 1).map(n => +n);
              const q = numbers.slice(-2).map(n => +n);
              const max = Math.max(...p.map(Math.abs), ...q.map(Math.abs), 0) + 100;
              const canvas = document.createElement("canvas");
              const size = Math.max(2 * max, 750);
              canvas.width  = size;
              canvas.height = size;
              const ctx = canvas.getContext("2d");
              while (contentDraw.firstChild) {
                  contentDraw.removeChild(contentDraw.firstChild);
              }
              contentDraw.appendChild(canvas);
              ctx.translate(max, max);

              ctx.strokeStyle = 'blue';
              ctx.arc(q[0], q[1], 2, 0, 2 * Math.PI);
              ctx.fill();

              ctx.moveTo(p[0], p[1]);
              for (let i = 2; i < p.length - 1; i += 2) {
                  ctx.lineTo(p[i], p[i+1]);
              }
              ctx.lineTo(p[0], p[1]);
              ctx.stroke();

              ctx.beginPath();
              ctx.strokeStyle = 'red';
              ctx.moveTo(q[0], q[1]);
              ctx.lineTo(p[0], p[1]);
              ctx.stroke();

            })
            .catch(error => {contentArea.value = error;});
          }
        });
  </script>
</body>
</html>
